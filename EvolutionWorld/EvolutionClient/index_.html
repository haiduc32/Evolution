<!DOCTYPE html>
<html>
<head>
	<title>Evolution</title>
	<style type="text/css">
		body {
			background-color: darkgray;
		}

		#canvas {
			width: 384px;
			height: 384px;
			background-color: white;
		}
		/*#entities {
			width: 240px;
			height: 240px;
		}*/
	</style>
	<script data-main="Scripts/main" src="Scripts/require.js"></script>
</head>
<body>
	<div id="canvas">
		<!--<canvas id="background"></canvas>-->
		<canvas id="entities" height="384" width="384"></canvas>
		<!--<canvas id="foreground"></canvas>-->
	</div>
	<div id="canvas2"></div>

	<div id="log"></div>
	<!--Script references. -->
	<!--Reference the jQuery library. -->
	<script src="Scripts/jquery-2.0.3.min.js"></script>
	<!--Reference the SignalR library. -->
	<script src="Scripts/jquery.signalR-2.0.1.min.js"></script>
	<!--Reference the autogenerated SignalR hub script. -->
	<script src="http://localhost:9999/signalr/hubs"></script>
	<!--Add script to update the page and send messages.-->
	<script type="text/javascript">

		$(function () {
			var entitiesCanvas = document.getElementById("entities");
			var entitiesContext = entitiesCanvas.getContext("2d");

			//Set the hubs URL for the connection
			$.connection.hub.url = "http://localhost:9999/signalr";

			// Declare a proxy to reference the hub.
			var evolution = $.connection.evolutionHub;


			// Get the user name and store it to prepend to messages.

			evolution.client.loadUnits = function (unitsLocations) {
				$.each(unitsLocations, function () {
					var location = this;
					//entitiesContext.fillStyle = 'red';
					//entitiesContext.fillRect(location.X * 24, location.Y * 24, 24, 24);

					entitiesContext.beginPath();
					entitiesContext.arc(location.X * 24 + 12, location.Y * 24 + 12, 11, 0, 2 * Math.PI, false);
					entitiesContext.fillStyle = 'green';
					entitiesContext.fill();
					entitiesContext.lineWidth = 1;
					entitiesContext.strokeStyle = 'black';
					entitiesContext.stroke();

					//entitiesContext.fillStyle = 'black';
					//entitiesContext.fillText(id, location.X * 24, location.Y * 24);
				});
			};

			evolution.client.unitMoved = function (id, lastLocation, newLocation) {
				entitiesContext.fillStyle = 'red';
				entitiesContext.clearRect(lastLocation.X * 24, lastLocation.Y * 24, 24, 24);
				//entitiesContext.fillRect(newLocation.X * 24, newLocation.Y * 24, 24, 24);

				entitiesContext.beginPath();
				entitiesContext.arc(newLocation.X * 24 + 12, newLocation.Y * 24 + 12, 11, 0, 2 * Math.PI, false);
				entitiesContext.fillStyle = 'green';
				entitiesContext.fill();
				entitiesContext.lineWidth = 1;
				entitiesContext.strokeStyle = 'black';
				entitiesContext.stroke();

				entitiesContext.fillStyle = 'white';
				entitiesContext.fillText(id, newLocation.X * 24 + 4, newLocation.Y * 24 + 15);
			};

			// Start the connection.
			$.connection.hub.start().done(function () {
				$('#log').append('Connected<br />');
				evolution.server.hello().done(function (serverAnswer) {
					$('#log').append("Server said: " + serverAnswer + "<br />");
				});;
			});
		});
	</script>
</body>
</html>